close all; clc; clear all; 
% % p = 1
% mass(1,1) = 0.004883;
% mass(1,2) = 0.001790;
% mass(1,3) = 0.002441;
% mass(2,1) = 0.001790;
% mass(2,2) = 0.001628;
% mass(2,3) = 0.001790;
% mass(3,1) = 0.002441;
% mass(3,2) = 0.001790;
% mass(3,3) = 0.004883;
% 
% R(1) = 0.000625;
% R(2) = 0.001250;
% R(3) = 0.000625;


% p = 2
nbasis = 6; 
mass(1,1) = 0.004883;
mass(1,2) = 0.001790;
mass(1,3) = 0.002441;
mass(1,4) = 0.000846;
mass(1,5) = 0.000423;
mass(1,6) = 0.001009;
mass(2,1) = 0.001790;
mass(2,2) = 0.001628;
mass(2,3) = 0.001790;
mass(2,4) = 0.000521;
mass(2,5) = 0.000521;
mass(2,6) = 0.000423;
mass(3,1) = 0.002441;
mass(3,2) = 0.001790;
mass(3,3) = 0.004883;
mass(3,4) = 0.000423;
mass(3,5) = 0.000846;
mass(3,6) = 0.001009;
mass(4,1) = 0.000846;
mass(4,2) = 0.000521;
mass(4,3) = 0.000423;
mass(4,4) = 0.000228;
mass(4,5) = 0.000114;
mass(4,6) = 0.000155;
mass(5,1) = 0.000423;
mass(5,2) = 0.000521;
mass(5,3) = 0.000846;
mass(5,4) = 0.000114;
mass(5,5) = 0.000228;
mass(5,6) = 0.000155;
mass(6,1) = 0.001009;
mass(6,2) = 0.000423;
mass(6,3) = 0.001009;
mass(6,4) = 0.000155;
mass(6,5) = 0.000155;
mass(6,6) = 0.000342;

R(1) = 0.000625;
R(2) = .00125;
R(3) = .000625;
R(4) = .000313;
R(5) = .000313;
R(6) = .000104;

% regularization
Areg = [mass; eye(nbasis)];
AregA = Areg'*Areg; 
breg = [R'; zeros(nbasis,1)];
Aregb = Areg'*breg;
qreg = inv(AregA)*Aregb;

% truncated SVD: A = U*S*V'
[U,S,V] = svd(mass); 
n = 3;
for i = n+1:length(S)
    S(i,i) = 0.0; 
end
Asvd = U(1:n,1:n)*S(1:n,1:n)*V(1:n,1:n)';
% qsvd = inv(Asvd)*


